name: Daily Auto Update (Alternative)

on:
  schedule:
    # ‡∏£‡∏±‡∏ô‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤ 00:00 UTC (07:00 ‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏ó‡∏¢)
    - cron: "0 0 * * *"
  workflow_dispatch: # ‡πÉ‡∏´‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏±‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ

jobs:
  daily-update:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          # ‡πÉ‡∏ä‡πâ PAT ‡πÅ‡∏ó‡∏ô GITHUB_TOKEN ‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤
          token: ${{ secrets.PAT_TOKEN || secrets.GITHUB_TOKEN }}
          fetch-depth: 0
        
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "18"
          cache: "npm"
        
      - name: Install dependencies
        run: npm install
      
      - name: Update daily data
        run: npm run update-data
      
      - name: Build project
        run: npm run build
      
      - name: Commit and push if changed
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          git add .
          
          # ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
          if git diff --staged --quiet; then
            echo "‚úÖ No changes to commit"
          else
            echo "üìù Changes detected, committing..."
            git commit -m "ü§ñ Daily auto update - $(date '+%Y-%m-%d %H:%M:%S UTC')"
            
            # ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏° push ‡∏î‡πâ‡∏ß‡∏¢‡∏ß‡∏¥‡∏ò‡∏µ‡∏ï‡πà‡∏≤‡∏á‡πÜ
            git push || {
              echo "üîÑ Retrying with alternative push method..."
              git push origin HEAD:${{ github.ref_name }}
            }
            
            echo "‚úÖ Successfully pushed changes"
          fi
      
      - name: Deploy to GitHub Pages
        if: success()
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./dist
          force_orphan: true
